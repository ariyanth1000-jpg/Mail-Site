<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Temp Mail</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:12px}
.box{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
button{padding:8px 12px;border:0;border-radius:8px;background:#007bff;color:#fff}
button.gray{background:#555}
.mail{border-bottom:1px solid #eee;padding:8px 0;cursor:pointer}
small{color:#555}
pre{white-space:pre-wrap}
</style>
</head>
<body>

<div class="box">
<h3>ðŸ“§ Temp Mail</h3>
<button onclick="generateEmail()">Generate Email</button>
<button class="gray" onclick="copyEmail()">Copy</button>
<p><b>Email:</b> <span id="email">---</span></p>
</div>

<div class="box">
<button onclick="loadInbox()">Refresh Inbox</button>
<div id="inbox">No mail yet</div>
</div>

<div class="box" id="mail">Select a mail</div>

<script>
const BASE="https://tinyhost.shop";
let cur={user:null,domain:null};

function rand(){
 let c="abcdefghijklmnopqrstuvwxyz0123456789",s="";
 for(let i=0;i<7;i++) s+=c[Math.random()*c.length|0];
 return s;
}

async function generateEmail(){
 const r=await fetch(BASE+"/api/random-domains/?limit=10");
 const d=await r.json();
 const domains=d.data?.domains||d.domains||d.data||d;
 cur.domain=domains[Math.random()*domains.length|0];
 cur.user=rand();
 document.getElementById("email").innerText=`${cur.user}@${cur.domain}`;
 loadInbox();
}

async function loadInbox(){
 if(!cur.user) return;
 const r=await fetch(`${BASE}/api/email/${cur.domain}/${cur.user}/?page=1&limit=20`);
 const d=await r.json();
 const mails=d.data?.emails||d.emails||d.data||[];
 let html="";
 if(!mails.length) html="No mail yet";
 mails.forEach(m=>{
  html+=`<div class="mail" onclick="openMail('${m.id||m.email_id||m._id}')">
  <b>${m.subject||"No subject"}</b><br>
  <small>${m.from||"unknown"}</small></div>`;
 });
 document.getElementById("inbox").innerHTML=html;
}

async function openMail(id){
 const r=await fetch(`${BASE}/api/email/${cur.domain}/${cur.user}/${id}`);
 const d=await r.json();
 const m=d.data?.email||d.email||d;
 document.getElementById("mail").innerHTML=
 `<h4>${m.subject||""}</h4>
 <small>${m.from||""}</small><hr>
 <pre>${m.body||m.text||""}</pre>`;
}

function copyEmail(){
 const e=document.getElementById("email").innerText;
 navigator.clipboard.writeText(e);
 alert("Copied!");
}

setInterval(loadInbox,5000);
</script>

</body>
</html>
